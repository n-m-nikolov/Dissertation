{% extends 'home.html' %}
{% block scripts %}
    <script src="//d3js.org/d3.v3.min.js"></script>

    <script>
        var graph = '{{ json_file|safe }}';
        graph = JSON.parse(graph);
        console.log(graph);

    </script>
{% endblock %}


{% block styles %}
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="//netdna.bootstrapcdn.com/bootstrap/3.1.1/css/bootstrap.min.css" rel="stylesheet" media="screen">


    <style>
        .container {
            max-width: 1000px;
        }
        .node {
            stroke-width: 1.5px;

        }

        .link {
            stroke: #999;
            stroke-opacity: .6;
        }

        .tips {
            border-color: #6699cc;
            background-color: #6699cc;
            color: #000000;
            max-width: 200px;
        }

        .tips .qtip-titlebar {
            text-align: center;
            padding: 0;
            background-color: #003366;
            color: white;
        }

        .CSSTableGenerator {
            float: left;
            margin: 0px;
            padding: 0px;
            width: 45%;
            box-shadow: 10px 10px 5px #888888;
            border: 1px solid #ffffff;

            -moz-border-radius-bottomleft: 0px;
            -webkit-border-bottom-left-radius: 0px;
            border-bottom-left-radius: 0px;

            -moz-border-radius-bottomright: 0px;
            -webkit-border-bottom-right-radius: 0px;
            border-bottom-right-radius: 0px;

            -moz-border-radius-topright: 0px;
            -webkit-border-top-right-radius: 0px;
            border-top-right-radius: 0px;

            -moz-border-radius-topleft: 0px;
            -webkit-border-top-left-radius: 0px;
            border-top-left-radius: 0px;
        }

        .CSSTableGenerator table {

            border-collapse: collapse;
            border-spacing: 0;
            width: 100%;
            height: 100%;
            margin-left: 240px;
            padding: 0px;
        }

        .CSSTableGenerator tr:last-child td:last-child {
            -moz-border-radius-bottomright: 0px;
            -webkit-border-bottom-right-radius: 0px;
            border-bottom-right-radius: 0px;
        }

        .CSSTableGenerator table tr:first-child td:first-child {
            -moz-border-radius-topleft: 0px;
            -webkit-border-top-left-radius: 0px;
            border-top-left-radius: 0px;
        }

        .CSSTableGenerator table tr:first-child td:last-child {
            -moz-border-radius-topright: 0px;
            -webkit-border-top-right-radius: 0px;
            border-top-right-radius: 0px;
        }

        .CSSTableGenerator tr:last-child td:first-child {
            -moz-border-radius-bottomleft: 0px;
            -webkit-border-bottom-left-radius: 0px;
            border-bottom-left-radius: 0px;
        }

        .CSSTableGenerator tr:hover td {
            background-color: #cccccc;

        }

        .CSSTableGenerator td {
            vertical-align: middle;

            background-color: #6699cc;

            border: 1px solid #ffffff;
            border-width: 0px 1px 1px 0px;
            text-align: center;
            padding: 7px;
            font-size: 12px;
            font-family: Arial;
            font-weight: normal;
            color: #000000;
            width: 50%;
        }

        .CSSTableGenerator tr:last-child td {
            border-width: 0px 1px 0px 0px;
        }

        .CSSTableGenerator tr td:last-child {
            border-width: 0px 0px 1px 0px;
        }

        .CSSTableGenerator tr:last-child td:last-child {
            border-width: 0px 0px 0px 0px;
        }

        .CSSTableGenerator tr:first-child td {
            background: -o-linear-gradient(bottom, #003366 5%, #003f7f 100%);
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0.05, #003366), color-stop(1, #003f7f));
            background: -moz-linear-gradient(center top, #003366 5%, #003f7f 100%);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#003366", endColorstr="#003f7f");
            background: -o-linear-gradient(top, #003366, 003 f7f);

            background-color: #003366;
            border: 0px solid #ffffff;
            text-align: center;
            border-width: 0px 0px 1px 1px;
            font-size: 14px;
            font-family: Arial;
            font-weight: bold;
            color: #ffffff;
        }

        .CSSTableGenerator tr:first-child:hover td {
            background: -o-linear-gradient(bottom, #003366 5%, #003f7f 100%);
            background: -webkit-gradient(linear, left top, left bottom, color-stop(0.05, #003366), color-stop(1, #003f7f));
            background: -moz-linear-gradient(center top, #003366 5%, #003f7f 100%);
            filter: progid:DXImageTransform.Microsoft.gradient(startColorstr="#003366", endColorstr="#003f7f");
            background: -o-linear-gradient(top, #003366, 003 f7f);

            background-color: #003366;
        }

        .CSSTableGenerator tr:first-child td:first-child {
            border-width: 0px 0px 1px 0px;
        }

        .CSSTableGenerator tr:first-child td:last-child {
            border-width: 0px 0px 1px 1px;
        }

    </style>
{% endblock %}


{% block navbar %}
    {{ super() }}
{% endblock %}

{% block content %}
    <div class="container">
    <div class="svg-pane">

    <script>

    var width = 960,
            height = 200;


    var color = d3.scale.category20();

    var force = d3.layout.force()
            .charge(-120)
            .linkDistance(30)
            .size([width, height]);


    var svg = d3.select("body").append("svg")
            .attr("width", width)
            .attr("height", height);

    //Set up tooltip


    force
            .nodes(graph.nodes)
            .links(graph.links)
            .start();

    var path = svg.selectAll("path.link")
            .data(graph.links)
            .enter().append("svg:path")
            .attr("class", "link")
            .attr("x1", function (d) {
                return d.source.x;
            })
            .attr("y1", function (d) {
                return d.source.y;
            })
            .attr("x2", function (d) {
                return d.target.x;
            })
            .attr("y2", function (d) {
                return d.target.y;
            })
            .attr("fill", "none")
            .attr("stroke-width", 5)
            .style("marker-end", "url(#suit)")  // Modified line FOR ARROWS
            .style("stroke-width", function (d) {
                return Math.sqrt(d.value);
            });


    //IF target > source links are underneath words
    //Arrows code
    svg.append("defs").selectAll("marker")
            .data(["suit", "licensing", "resolved"])
            .enter().append("marker")
            .attr("id", function (d) {
                return d;
            })
            .attr("viewBox", "0 -5 10 10")
            .attr("refX", 10)
            .attr("refY", 0)
            .attr("markerWidth", 6)
            .attr("markerHeight", 6)
            .attr("orient", "auto")
            .append("path")
            .attr("d", "M0,-5L10,0L0,5 L10,0 L0, -5")
            .style("stroke", "#000000")
            .style("opacity", "1");
    //Arrows Code end

    var rect = svg.append("rect")
            .attr("x", 0)
            .attr("y", 0)
            .attr("width", 0)
            .attr("height", 0)
            .attr("fill", "white");

    var node = svg.selectAll(".node")
            .data(graph.nodes)
            .enter().append("text")
            .attr("id", function (d, i) {
                d["idNumber"] = i;
                return "node_" + d.idNumber;
            })
            .attr("tag", function (d) {
                return d.tag;
            })
            .attr("relation", function (d) {
                return d.relation;
            })
            .attr("governor", function (d) {
                return d.governor;
            })

            .attr("class", "node")
            .text(function (d) {
                //d.width = this.getBBox().width;
                //d.height = this.getBBox().height;
                return d.name;
            })
            .attr("font-size", "20px")

            .attr("fill", function (d) {
                //Override color from [return color(d.group)] to be alwasy black
                return d3.rgb(0, 0, 0);
            })
            .on("DOMAttrModified", function (d) {
                d.width = this.getBBox().width;
                d.height = this.getBBox().height;
            })
            .on("DOMNodeInserted", function (d) {
                d.width = this.getBBox().width;
                d.height = this.getBBox().height;

            });
    //Uncomment for dragging nodes
    //.call(force.drag);

    //NEW CODE FOR PATH
    force.on("tick", tick);
    function tick() {
        path.attr("d", function (d) {

            var dx = d.target.x - d.source.x,
                    dy = d.target.y - d.source.y,
                    dr = Math.sqrt(dx * dx + dy * dy);
            if (d.target.x > d.source.x) {
                return "M" + d.source.x + "," + (d.source.y - d.source.height + 10) + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + (d.target.y - d.source.height + 10);
            } else {
                return "M" + d.source.x + "," + d.source.y + "A" + dr + "," + dr + " 0 0,1 " + d.target.x + "," + d.target.y;
            }

        });


        node.attr("x", function (d) {

            return d.x - 0.5 * d.width;

        })

                .attr("y", function (d) {
                    return d.y;
                });


        //Position for first node
        //Change +100 to +x to change fist node position and move the whole line left- or right+
        var currNodePosition = graph.nodes[0].width / 2 + 100;

        for (var i = 0; i < graph.nodes.length; i++) {
            var word = graph.nodes[i];
            nextNode = graph.nodes[i + 1];
            word["fixed"] = true;
            word["px"] = currNodePosition;
            word["py"] = 100;
            rect.attr("width", word["px"]);
            rect.attr("height", word["height"] - 10);
            rect.attr("y", word["py"] - word["height"] + 10);
            rect.attr("opacity", 0.1);
            if (i != graph.nodes.length - 1) {
                currNodePosition += word.width / 2 + nextNode.width / 2 + 10;
            }

        }

    }
    //When the text is changed the width of the drawn words is changed as well

    //When the text is created change the width on the spot


    node.append("title")
            .text(function (d) {
                return d.name;
            });

    //remove the native tooltips that show when you hover on each node, they will be replaced with custom one that sho more information.
    $('.node > title').remove();
    //Tooltip on every node
    $('.node').each(function () { // Grab all elements with a title attribute,and set "this"
        $(this).qtip({ //
            style: {
                classes: 'tips qtip-rounded qtip-shadow'
            },
            content: {
                text: function () {
                    // Retrieve content from ALT attribute of the $('.selector') element
                    return "<center>" + "POS Tag: " + "<b>" + $(this).attr('tag') + "</b>" + "<br>" + "<br>" + "Dependant on:  " + "<b>" + "\"" + $(this).attr('governor') + "\"" + "</b>" + "</br>" + "<br>" + "Relation Type:  " + "<b>" + $(this).attr('relation') + "</b>" + "</center>";
                },
                title: function () {
                    // Retrieve content from ALT attribute of the $('.selector') element
                    return "<br>" + "Additional Information" + "<br>" + "<br>";
                }
            },
            position: {
                viewport: $(window), //Prevents Qtip from drawing out of the borders of the window
                my: 'top center',
                at: 'bottom center'
            }
        });
    });


    // });

    </script>


    </div>


    </div>
    <br>
    <br>
    <div class="CSSTableGenerator">
        <table>
            <tr>
            <td colspan="2">Part of Speech Tags</td>
            </tr>
            <tr>
                <td>
                    CC
                </td>
                <td>
                   Coordinating conjunction
                </td>
            </tr>
            <tr>
                <td>
                   CD
                </td>
                <td>
                    Cardinal number
                </td>
            </tr>
            <tr>
                <td>
                 	DT
                </td>
                <td>
                    Determiner
                </td>
            </tr>
            <tr>
                <td>
                    EX
                </td>
                <td>
                    Existential <i>there</i>
                </td>
            </tr>
                        <tr>
                <td>
                    FW
                </td>
                <td>
                    Foreign Word
                </td>
            </tr>
                        <tr>
                <td>
                    IN
                </td>
                <td>
                    Preposition or subordinating conjunction
                </td>
            </tr>
                        <tr>
                <td>
                    JJ
                </td>
                <td>
                     Adjective
                </td>
            </tr>
                        <tr>
                <td>
                    JJR
                </td>
                <td>
                    Adjective, comparative
                </td>
            </tr>
                        <tr>
                <td>
                   JJS
                </td>
                <td>
                   	Adjective, superlative
                </td>
            </tr>
                        <tr>
                <td>
                    LS
                </td>
                <td>
                    List item marker
                </td>
            </tr>
                        <tr>
                <td>
                    EX
                </td>
                <td>
                    Existential <i>there</i>
                </td>
            </tr>
                        <tr>
                <td>
                    	MD
                </td>
                <td>
                    Modal
                </td>
            </tr>
                        <tr>
                <td>
                    NN
                </td>
                <td>
                Noun, singular or mass
                </td>
            </tr>
                        <tr>
                <td>
                    NNS
                </td>
                <td>
                    Noun, plural
                </td>
            </tr>
                        <tr>
                <td>
                    NNP
                </td>
                <td>
                    Proper noun, singular
                </td>
            </tr>

        </table>
    </div>



    <br><br>

{% endblock %}